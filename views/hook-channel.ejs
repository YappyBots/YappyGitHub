<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="preload" href="https://unpkg.com/bulma-prefers-dark" as="style" />

    <%- include('./partials/head') %>
    
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/bulma-prefers-dark" />

    <title>Hook | Yappy GitHub</title>
</head>
<body>
    <nav class="navbar is-transparent has-shadow">
        <div class="navbar-brand">
          <a class="navbar-item  has-text-weight-semibold" href="<%= process.env.WEB_HOST %>">
            Yappy GitHub
          </a>
        </div>
      </nav>

    <div class="container">
        <h1 class="title mt-6">Configuring a Hook</h1>

        <div class="content">
            This hook will forward events to the following channels:

            <ul>
                <% for (const [id, data] of channels) { %>
                    <li>
                        <% if (data) { %>
                            <a href="https://discord.com/channels/<%= data.guild.id %>/<%= data.id %>" target="_blank"><%= data.guild.name %> #<%= data.name %></a>
                        <% } else { %>
                            ‚ùå <em>Not Found. Try again later.</em>
                        <% } %>
                        
                        (<code><%= id %></code>)
                    </li>
                <% } %>
            </ul>
        </div>

        <h2 class="subtitle is-4">Instructions</h2>

        <p>
            Create a webhook on the GitHub repository or organization you wish to receive events for in the channels listed above. <br>
            Keep in mind per-channel configurations apply individually. In other words, events ignored in one channel will still be sent to the others unless you configure them otherwise.
        </p>

        <table class="table mt-5">
            <tr>
                <th>Payload URL</th>
                <td>
                    <% const link = `${process.env.WEB_HOST}/hook/channels/${ids.join(',')}` %>

                    <a href="<%= link %>"><%= link %></a>
                </td>
            </tr>
            <tr>
                <th>Content Type</th>
                <td><code>application/json</code></td>
            </tr>
            <tr>
                <th>Secret</th>
                <td>
                    <p>View your channel's secret by running <code>/conf option channel item:secret</code>.</p>
                    <% if (ids.length > 1) { %>
                        <br>
                        <p>
                            Since you're sending the hook to multiple channels at once, make sure their secrets are all the same. <br />
                            The event will only be sent to channels whose secret matches the incoming webhook's.
                        </p>
                    <% } %>
                </td>
            </tr>
        </table>
    </div>
</body>
</html>